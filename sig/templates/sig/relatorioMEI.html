{% extends "sig/_base.html" %}

{% block title %}Gestão MEI - SIG{% endblock %}

{% block content %}
<div class="container">
    <h1>Gestão MEI</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flashes">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="form-container">
        <form method="POST" action="{{ url_for('sig.cadastrar_relatorio_mei') }}">
            {{ form.hidden_tag() }}
            <fieldset class="form"><legend>Relatório Mensal das Receitas Brutas</legend>
                <div class="form-group">{{ form.apuracao.label }} {{ form.apuracao(class="form-control") }}</div>
                <div class="form-group">{{ form.cnpj.label }} {{ form.cnpj(class="form-control") }}</div>
                <div class="form-group">{{ form.razao_social.label }} {{ form.razao_social(class="form-control") }}</div>
            </fieldset>
            <fieldset class="form"><legend>Receita Bruta Total - Venda de Produtos (Comércio)</legend>
                <div class="form-group">{{ form.pdn.label }} {{ form.pdn(class="form-control") }}</div>
                <div class="form-group">{{ form.pen.label }} {{ form.pen(class="form-control") }}</div>
            </fieldset>
            <fieldset class="form"><legend>Receita Bruta Mensal - Prestação de Serviços</legend>
                <div class="form-group">{{ form.sdn.label }} {{ form.sdn(class="form-control") }}</div>
                <div class="form-group">{{ form.sen.label }} {{ form.sen(class="form-control") }}</div>
            </fieldset>
            <fieldset class="form"><legend>Validação</legend>
                <div class="form-group">{{ form.local.label }} {{ form.local(class="form-control") }}</div>
                <div class="form-group">{{ form.data.label }} {{ form.data(class="form-control") }}</div>
                <div class="form-group">{{ form.assinatura.label }} {{ form.assinatura(class="form-control") }}</div>
            </fieldset>
            {{ form.submit(class="btn btn-primary") }}
        </form>
    </div>

    <hr>
    <h2>Relatórios Salvos</h2>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    {% for header in cabecalho %}
                        <th>{{ header }}</th>
                    {% endfor %}
                    <th>Ação</th>
                </tr>
            </thead>
            <tbody>
                {% for row in dados %}
                <tr>
                    {% for value in row %}
                        <td>{{ value }}</td>
                    {% endfor %}
                    <td>
                        <form action="{{ url_for('sig.delete_record', table_name=table_name, record_id=row.id) }}" method="POST" onsubmit="return confirm('Tem certeza que deseja deletar este registro?');">
                            {{ form.hidden_tag() }}
                            <button type="submit" class="btn-delete">
                                <img src="{{ url_for('static', filename='icon/delete.png') }}" alt="Deletar" />
                            </button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="{{ cabecalho|length + 1 }}">Nenhum relatório encontrado.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}